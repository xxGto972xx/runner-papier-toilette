<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Runner Papier Toilette</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<style>
html,body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family: Arial, sans-serif;
  background:#87CEEB;
  touch-action: manipulation;
}

#hud{
  position:absolute;
  top:10px;
  left:10px;
  right:10px;
  display:flex;
  justify-content:space-between;
  z-index:10;
  font-weight:bold;
}

.hud-box{
  background:rgba(255,255,255,0.75);
  padding:6px 12px;
  border-radius:14px;
}

canvas{
  display:block;
  width:100%;
  height:80vh;
}

#controls{
  height:20vh;
  display:flex;
}

button{
  flex:1;
  font-size:26px;
  font-weight:bold;
  border:none;
  color:white;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

#jump{ background:#34a853; }
#slide{ background:#f29900; }
button:active{ filter:brightness(0.9); }
</style>
</head>

<body>

<div id="hud">
  <div class="hud-box" id="score">Rouleaux: 0</div>
  <div class="hud-box" id="speed">Vitesse: 1.0x</div>
</div>

<canvas id="game"></canvas>

<div id="controls">
  <button id="jump">SAUT</button>
  <button id="slide">GLISSE</button>
</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let W,H;
function resize(){
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight * 0.8;
}
resize();
window.addEventListener("resize", resize);

function groundY(){ return H * 0.75; }

// --- GAME ---
let gameTime = 0;
let speedMult = 1;
let speed = 200;
let score = 0;

// --- PLAYER ---
const player = {
  x: 80,
  y: groundY() - 60,
  w: 40,
  h: 60,
  vy: 0,
  onGround: true,
  sliding: false,
  slideTime: 0
};

// --- ENTITIES ---
const obstacles = [];
const rolls = [];

// --- CONTROLS ---
function fastPress(btn, fn){
  btn.addEventListener("pointerdown", e => { e.preventDefault(); fn(); }, {passive:false});
  btn.addEventListener("touchstart", e => { e.preventDefault(); fn(); }, {passive:false});
}

fastPress(document.getElementById("jump"), ()=>{
  if(player.onGround){
    player.vy = -900;
    player.onGround = false;
    player.sliding = false;
  }
});

fastPress(document.getElementById("slide"), ()=>{
  if(player.onGround && !player.sliding){
    player.sliding = true;
    player.slideTime = 0.5;
  }
});

// --- SPAWN ---
let spawnTimer = 1.8;
function spawnObstacle(){
  obstacles.push({ x:W, y:groundY()-30, w:30, h:30 });
  if(Math.random()<0.6){
    rolls.push({ x:W+150, y:groundY()-120, w:30, h:30 });
  }
}

// --- UPDATE ---
function update(dt){
  gameTime += dt;
  speedMult = 1 + gameTime * 0.05;
  speed = 200 * speedMult;
  document.getElementById("speed").textContent = "Vitesse: " + speedMult.toFixed(1) + "x";

  player.vy += 2200 * dt;
  player.y += player.vy * dt;

  if(player.y >= groundY() - player.h){
    player.y = groundY() - player.h;
    player.vy = 0;
    player.onGround = true;
  }

  if(player.sliding){
    player.slideTime -= dt;
    if(player.slideTime<=0) player.sliding=false;
  }

  spawnTimer -= dt;
  if(spawnTimer<=0){
    spawnObstacle();
    spawnTimer = Math.max(0.8, 1.8 - gameTime * 0.05);
  }

  obstacles.forEach(o=>o.x -= speed*dt);
  rolls.forEach(r=>r.x -= speed*dt);

  obstacles.forEach(o=>{
    if(o.x < player.x+player.w &&
       o.x+o.w > player.x &&
       o.y < player.y + (player.sliding?30:player.h) &&
       o.y+o.h > (player.sliding?groundY()-30:player.y)){
      alert("Perdu !");
      location.reload();
    }
  });

  rolls.forEach((r,i)=>{
    if(r.x < player.x+player.w &&
       r.x+r.w > player.x &&
       r.y < player.y+player.h &&
       r.y+r.h > player.y){
      rolls.splice(i,1);
      score++;
      document.getElementById("score").textContent = "Rouleaux: " + score;
    }
  });
}

// --- DRAW ---
function draw(){
  ctx.clearRect(0,0,W,H);

  const sky = ctx.createLinearGradient(0,0,0,H);
  sky.addColorStop(0,"#6ec6ff");
  sky.addColorStop(1,"#eaf8ff");
  ctx.fillStyle=sky;
  ctx.fillRect(0,0,W,H);

  ctx.fillStyle="#49c880";
  ctx.fillRect(0,groundY(),W,H-groundY());

  obstacles.forEach(o=>drawPoop(o.x,o.y,o.w,o.h));
  rolls.forEach(r=>drawRoll(r.x,r.y,r.w,r.h));

  drawRunner(player.x, player.sliding?groundY()-48:player.y, player.sliding);
}

// --- DRAW HELPERS ---
function drawRunner(x,y,sliding){
  ctx.save(); ctx.translate(x,y);
  const h=sliding?48:60,w=sliding?56:40;
  const t=performance.now()/120;
  ctx.fillStyle="#1e88e5";
  roundRect(8,18,w-16,h-22,10,true);
  ctx.fillStyle="#ffe0bd";
  ctx.beginPath(); ctx.arc(w/2,14,10,0,Math.PI*2); ctx.fill();
  ctx.strokeStyle="rgba(0,0,0,.6)";
  ctx.lineWidth=3;
  if(!sliding){
    ctx.beginPath(); ctx.moveTo(14,h-8); ctx.lineTo(10-Math.sin(t)*6,h+8); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(26,h-8); ctx.show?null:ctx.lineTo(30+Math.sin(t)*6,h+8); ctx.stroke();
  }
  ctx.restore();
}

function drawPoop(x,y,w,h){
  ctx.save(); ctx.translate(x,y);
  ctx.fillStyle="#7a4a21";
  roundRect(0,h*0.45,w,h*0.55,10,true);
  roundRect(w*0.15,h*0.2,w*0.7,h*0.35,10,true);
  roundRect(w*0.3,0,w*0.4,h*0.25,10,true);
  ctx.restore();
}

function drawRoll(x,y,w,h){
  ctx.save(); ctx.translate(x+w/2,y+h/2);
  ctx.fillStyle="#fff";
  roundRect(-w/2,-h/2,w,h,10,true);
  ctx.fillStyle="#ccc";
  ctx.beginPath(); ctx.arc(0,0,7,0,Math.PI*2); ctx.fill();
  ctx.restore();
}

function roundRect(x,y,w,h,r,f){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
  if(f) ctx.fill();
}

// --- LOOP ---
let last=performance.now();
function loop(now){
  const dt=Math.min((now-last)/1000,0.033);
  last=now;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>
